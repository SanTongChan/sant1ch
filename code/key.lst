C51 COMPILER V9.52.0.0   KEY                                                               08/30/2017 23:09:24 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files (x86)\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\common;.\code\drive
                    -r;.\code\flash;.\code\key;.\code\led;.\code\logic;.\code\remote;.\code\sant1ch;.\code\timer) DEBUG OBJECTEXTEND PRINT(.\
                    -key.lst) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          #include "remote.h"
   6          
   7          
   8          static bool key1_is_press(void)
   9          {
  10   1          if(0 == KEY1)
  11   1          {
  12   2              return true;
  13   2          }
  14   1          return false;
  15   1      }
  16          static bool key2_is_press(void)
  17          {
  18   1          if(0 == KEY2)
  19   1          {
  20   2              return true;
  21   2          }
  22   1          return false;
  23   1      }
  24          
  25          static void key1_short_press(void)
  26          {
  27   1              if(dev_def.dev_mode == DEV_REMOTE)
  28   1              {
  29   2                      
  30   2              }
  31   1              else if(dev_def.dev_mode == DEV_TIME)
  32   1              {
  33   2      
  34   2              }
  35   1              else
  36   1              {
  37   2                      //KEY = 0;
  38   2              }
  39   1      }
  40          static void key1_short_up_press(void)
  41          {
  42   1              if(dev_def.dev_mode == DEV_REMOTE)
  43   1              {
  44   2                      
  45   2              }
  46   1              else if(dev_def.dev_mode == DEV_TIME)
  47   1              {
  48   2      
  49   2              }
  50   1              else
  51   1              {
  52   2                      CON_RELAY = !RELAY1;
  53   2                      //KEY = 1;
C51 COMPILER V9.52.0.0   KEY                                                               08/30/2017 23:09:24 PAGE 2   

  54   2                      dev_def.update_flag = true;
  55   2              }
  56   1      }
  57          static void key2_short_press(void)
  58          {
  59   1              //RF_LED = !RF_LED;
  60   1      }
  61          static void key2_short_up_press(void)
  62          {
  63   1              
  64   1      }
  65          static void key1_long_press(void)
  66          {
  67   1              if(dev_def.dev_mode == DEV_REMOTE)
  68   1              {
  69   2                      
  70   2              }
  71   1              else if(dev_def.dev_mode == DEV_TIME)
  72   1              {
  73   2      
  74   2              }
  75   1              else
  76   1              {
  77   2                      KEY = 1;
  78   2              }
  79   1      }
  80          static void key2_long_press(void)
  81          {
  82   1      
  83   1      }
  84          
  85          static void key1_long_up_press(void)
  86          {
  87   1      
  88   1      }
  89          static void key2_long_up_press(void)
  90          {
  91   1      
  92   1      }
  93          static void key1_twice_press(void)
  94          {
  95   1              if(dev_def.dev_mode == DEV_JOGGING)
  96   1              {
  97   2                      dev_def.dev_mode = DEV_SELFLOCK;
  98   2                      CON_RELAY = 0;
  99   2                      dev_def.update_flag = true;
 100   2              }
 101   1              else if(dev_def.dev_mode == DEV_SELFLOCK)
 102   1              {
 103   2                      dev_def.dev_mode = DEV_JOGGING;
 104   2                      CON_RELAY = 0;
 105   2                      dev_def.update_flag = true;
 106   2              }
 107   1              else
 108   1              {
 109   2                      /*do nothing*/
 110   2              }
 111   1      }
 112          static void key2_twice_press(void)
 113          {
 114   1      
 115   1      }
C51 COMPILER V9.52.0.0   KEY                                                               08/30/2017 23:09:24 PAGE 3   

 116          
 117          static void registerKeys(void)
 118          {
 119   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,key1_long_press,key1_long_up_pres
             -s,key1_twice_press);
 120   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,key2_long_press,key2_long_up_pres
             -s,key2_twice_press);
 121   1      }
 122          void keyInit(void)
 123          {
 124   1              P1M1 |= 0xA0;//初始化为输入
 125   1              P1M2 &= 0X5f;
 126   1              P0M1 &= 0xE7;
 127   1              P0M2 |= 0X18; 
 128   1              CON_RELAY = 0;
 129   1              registerKeys();
 130   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    226    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
