C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 01:22:03 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files (x86)\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\common;.\code\drive
                    -r;.\code\flash;.\code\key;.\code\led;.\code\logic;.\code\remote;.\code\sant1ch;.\code\timer) DEBUG OBJECTEXTEND PRINT(.\
                    -key.lst) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          #include "remote.h"
   6          
   7          
   8          static bool key1_is_press(void)
   9          {
  10   1          if(0 == KEY1)
  11   1          {
  12   2              return true;
  13   2          }
  14   1          return false;
  15   1      }
  16          static bool key2_is_press(void)
  17          {
  18   1          if(0 == KEY2)
  19   1          {
  20   2              return true;
  21   2          }
  22   1          return false;
  23   1      }
  24          
  25          static void key1_short_press(void)
  26          {
  27   1              if(dev_def.dev_mode == DEV_REMOTE)
  28   1              {
  29   2                      
  30   2              }
  31   1              else if(dev_def.dev_mode == DEV_TIME)
  32   1              {
  33   2      
  34   2              }
  35   1              else
  36   1              {
  37   2                      KEY = 0;
  38   2              }
  39   1      }
  40          static void key1_short_up_press(void)
  41          {
  42   1              if(dev_def.dev_mode == DEV_REMOTE)
  43   1              {
  44   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  45   2                      RfLedOff();
  46   2              }
  47   1              else if(dev_def.dev_mode == DEV_TIME)
  48   1              {
  49   2                      incJoggingTime();       
  50   2              }
  51   1              else
  52   1              {
  53   2                      CON_RELAY = !RELAY1;
C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 01:22:03 PAGE 2   

  54   2                      KEY = 1;
  55   2                      dev_def.update_flag = true;
  56   2              }
  57   1      }
  58          static void key2_short_press(void)
  59          {
  60   1              //RF_LED = !RF_LED;
  61   1      }
  62          static void key2_short_up_press(void)
  63          {
  64   1              if(dev_def.dev_mode == DEV_REMOTE)
  65   1              {
  66   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  67   2                      RfLedOff();
  68   2              }
  69   1              else if(dev_def.dev_mode == DEV_TIME)
  70   1              {
  71   2                      decJoggingTime();
  72   2              }
  73   1      }
  74          static void key1_long_press(void)
  75          {
  76   1              if(dev_def.dev_mode == DEV_REMOTE)
  77   1              {
  78   2                      
  79   2              }
  80   1              else if(dev_def.dev_mode == DEV_TIME)
  81   1              {
  82   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  83   2                      RfLedOff();
  84   2              }
  85   1              else
  86   1              {
  87   2                      KEY = 1;
  88   2              }
  89   1      }
  90          static void key2_long_press(void)
  91          {
  92   1              if(dev_def.dev_mode == DEV_TIME)
  93   1              {
  94   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  95   2                      RfLedOff();
  96   2              }
  97   1              else if(dev_def.dev_mode != DEV_REMOTE)
  98   1              {
  99   2                      dev_def.dev_mode = DEV_REMOTE;
 100   2                      //清除码值
 101   2                      RfLedBlink(10,10);
 102   2              }
 103   1      }
 104          
 105          static void key1_long_up_press(void)
 106          {
 107   1              
 108   1      }
 109          static void key2_long_up_press(void)
 110          {
 111   1              
 112   1      }
 113          static void key1_twice_press(void)
 114          {
 115   1              if(dev_def.dev_mode == DEV_JOGGING)
C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 01:22:03 PAGE 3   

 116   1              {
 117   2                      dev_def.dev_mode = DEV_SELFLOCK;
 118   2                      dev_def.last_dev_mode = DEV_SELFLOCK;
 119   2                      CON_RELAY = 0;
 120   2                      dev_def.update_flag = true;
 121   2              }
 122   1              else if(dev_def.dev_mode == DEV_SELFLOCK)
 123   1              {
 124   2                      dev_def.dev_mode = DEV_JOGGING;
 125   2                      dev_def.last_dev_mode = DEV_JOGGING;
 126   2                      CON_RELAY = 0;
 127   2                      dev_def.update_flag = true;
 128   2              }
 129   1              else
 130   1              {
 131   2                      /*do nothing*/
 132   2              }
 133   1      }
 134          static void key2_twice_press(void)
 135          {
 136   1              if(dev_def.dev_mode != DEV_REMOTE)
 137   1              {
 138   2                      dev_def.dev_mode = DEV_TIME;
 139   2                      RfLedOnXt(10,10,1);
 140   2              }
 141   1      }
 142          
 143          static void registerKeys(void)
 144          {
 145   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,key1_long_press,key1_long_up_pres
             -s,key1_twice_press);
 146   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,key2_long_press,key2_long_up_pres
             -s,key2_twice_press);
 147   1      }
 148          void keyInit(void)
 149          {
 150   1              P1M1 |= 0xA0;//初始化为输入
 151   1              P1M2 &= 0X5f;
 152   1              P0M1 &= 0xE7;
 153   1              P0M2 |= 0X18; 
 154   1              CON_RELAY = 0;
 155   1              registerKeys();
 156   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    368    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
