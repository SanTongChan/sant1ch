C51 COMPILER V9.52.0.0   KEY                                                               08/19/2017 17:16:41 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files (x86)\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\common;.\code\drive
                    -r;.\code\flash;.\code\key;.\code\led;.\code\logic;.\code\remote;.\code\sant1ch;.\code\timer) DEBUG OBJECTEXTEND PRINT(.\
                    -key.lst) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          #include "remote.h"
   6          
   7          sbit KEY1 = P1^5;       //模式键
   8          sbit KEY2 = P1^7;  //通道键
   9          
  10          static bool key1_is_press(void)
  11          {
  12   1          if(0 == KEY1)
  13   1          {
  14   2              return true;
  15   2          }
  16   1          return false;
  17   1      }
  18          static bool key2_is_press(void)
  19          {
  20   1          if(0 == KEY2)
  21   1          {
  22   2              return true;
  23   2          }
  24   1          return false;
  25   1      }
  26          
  27          static void key1_short_press(void)
  28          {
  29   1      #if 0
                  if(dev_def.remote)
                  {
                      clearIrData();
                      RF_LED = 1;
                      dev_def.remote_channel = 1;
                  }
                  else
                  {
                      if(h595_val | KEY1_595)
                      {
                          h595_val = h595_val & (~KEY1_595);
                          SendTo595(h595_val);
                      }
                  }
              #endif
  45   1      }
  46          static void key2_short_press(void)
  47          {
  48   1      #if 0
                  if(dev_def.remote)
                  {
                      clearIrData();
                      RF_LED = 1;
                      dev_def.remote_channel = 2;
C51 COMPILER V9.52.0.0   KEY                                                               08/19/2017 17:16:41 PAGE 2   

                  }
                  else
                  {
                      if(h595_val | KEY2_595)
                      {
                          h595_val = h595_val & (~KEY2_595);
                              SendTo595(h595_val);    
                      }
                      }
              #endif
  64   1      }
  65          static void key1_short_up_press(void)
  66          {
  67   1      #if 0
                  if(!dev_def.remote)
                  {
                      if(RELAY1)
                      {
                          h595_val &= (~RELAY1_595);
                      }
                      else
                      {
                          if(dev_def.lock)
                          {
                              h595_val &= 0x0f;
                          }
                          h595_val |= RELAY1_595;
                      }
                      h595_val |= KEY1_595;
                      SendTo595(h595_val);
                      if(dev_def.setting == true)
                      {
                          dev_def.setting = false;
                          update_time = 10;
                      }
                      else
                      {
                          update_time = 5;
                      }
                      dev_def.dev_channel[0].update_flag = true;
                      dev_def.dev_channel[1].update_flag = true;
                      dev_def.dev_channel[2].update_flag = true;
                      dev_def.dev_channel[3].update_flag = true;
                      dev_def.update_local_cnt = 0;
                  }
                  else
                  {
                      RF_LED = 0;
                  }
              #endif
 104   1      }
 105          static void key2_short_up_press(void)
 106          {
 107   1      #if 0
                  if(!dev_def.remote)
                  {
                      if(RELAY2)
                      {
                          h595_val &= (~RELAY2_595);
                      }
                      else
                      {
C51 COMPILER V9.52.0.0   KEY                                                               08/19/2017 17:16:41 PAGE 3   

                          if(dev_def.lock)
                          {
                              h595_val &= 0x0f;
                          }
                          h595_val |= RELAY2_595; 
                      }
                      h595_val |= KEY2_595;
                      SendTo595(h595_val);
                      if(dev_def.setting == true)
                      {
                          dev_def.setting = false;
                          update_time = 10;
                      }
                      else
                      {
                          update_time = 5;
                      }
                      dev_def.dev_channel[0].update_flag = true;
                      dev_def.dev_channel[1].update_flag = true;
                      dev_def.dev_channel[2].update_flag = true;
                      dev_def.dev_channel[3].update_flag = true;
                      dev_def.update_local_cnt = 0;
                  }
                  else
                  {
                      RF_LED = 0;
                  }
              #endif
 144   1      }
 145          
 146          
 147          static void key1_long_press(void)
 148          {
 149   1      #if 0
                  if(dev_def.remote)
                  {
                      dev_def.dev_channel[0].remote_val = 0;
                      RF_LED = 0;
                  }
              #endif
 156   1      }
 157          static void key2_long_press(void)
 158          {
 159   1      #if 0
                  if(dev_def.remote)
                  {
                      dev_def.dev_channel[1].remote_val = 0;
                      RF_LED = 0;
                  }
              #endif
 166   1      }
 167          
 168          static void key1_long_up_press(void)
 169          {
 170   1      #if 0
                  if(!dev_def.remote)
                  {
                      h595_val |= KEY1_595;
                      update_time = 10;
                      dev_def.setting = true;
                      SendTo595(h595_val);
                  }
C51 COMPILER V9.52.0.0   KEY                                                               08/19/2017 17:16:41 PAGE 4   

              #endif
 179   1      }
 180          static void key2_long_up_press(void)
 181          {
 182   1      #if 0
                  if(!dev_def.remote)
                  {
                      h595_val |= KEY2_595;
                      update_time = 10;
                      dev_def.setting = true;
                      SendTo595(h595_val);
                      }
              #endif
 191   1      }
 192          static void key1_twice_press(void)
 193          {
 194   1      #if 0
                  if(dev_def.dev_channel[0].channel_mode == DEV_JOGGING)
                  {
                      dev_def.dev_channel[0].channel_mode = DEV_SELFLOCK;
                  }
                  else
                  {
                      dev_def.dev_channel[0].channel_mode = DEV_JOGGING;
                  }
                  dev_def.dev_channel[0].update_flag = true; 
                  dev_def.update_local_cnt = 0;
                  save_mode_flag = true;
              #endif
 207   1      }
 208          static void key2_twice_press(void)
 209          {
 210   1      #if 0
                  if(dev_def.dev_channel[1].channel_mode == DEV_JOGGING)
                  {
                      dev_def.dev_channel[1].channel_mode = DEV_SELFLOCK;
                  }
                  else
                  {
                      dev_def.dev_channel[1].channel_mode = DEV_JOGGING;
                  }
                  dev_def.dev_channel[1].update_flag = true; 
                  dev_def.update_local_cnt = 0;
                  save_mode_flag = true;
              #endif
 223   1      }
 224          
 225          static void registerKeys(void)
 226          {
 227   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,key1_long_press,key1_long_up_pres
             -s,key1_twice_press);
 228   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,key2_long_press,key2_long_up_pres
             -s,key2_twice_press);
 229   1      }
 230          void keyInit(void)
 231          {
 232   1              P1M1 |= 0xA0;//初始化P10 -> P14为输入
 233   1              P1M2 &= 0X5f;
 234   1              registerKeys();
 235   1      }


C51 COMPILER V9.52.0.0   KEY                                                               08/19/2017 17:16:41 PAGE 5   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    145    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
