C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 00:44:39 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN key.obj
COMPILER INVOKED BY: F:\Program Files (x86)\Keil\C51\BIN\C51.EXE code\key\key.c BROWSE INCDIR(.\code\common;.\code\drive
                    -r;.\code\flash;.\code\key;.\code\led;.\code\logic;.\code\remote;.\code\sant1ch;.\code\timer) DEBUG OBJECTEXTEND PRINT(.\
                    -key.lst) OBJECT(key.obj)

line level    source

   1          #include "key.h"
   2          #include "key_driver.h"
   3          #include "led.h"
   4          #include "logic.h"
   5          #include "remote.h"
   6          
   7          
   8          static bool key1_is_press(void)
   9          {
  10   1          if(0 == KEY1)
  11   1          {
  12   2              return true;
  13   2          }
  14   1          return false;
  15   1      }
  16          static bool key2_is_press(void)
  17          {
  18   1          if(0 == KEY2)
  19   1          {
  20   2              return true;
  21   2          }
  22   1          return false;
  23   1      }
  24          
  25          static void key1_short_press(void)
  26          {
  27   1              if(dev_def.dev_mode == DEV_REMOTE)
  28   1              {
  29   2                      
  30   2              }
  31   1              else if(dev_def.dev_mode == DEV_TIME)
  32   1              {
  33   2      
  34   2              }
  35   1              else
  36   1              {
  37   2                      KEY = 0;
  38   2              }
  39   1      }
  40          static void key1_short_up_press(void)
  41          {
  42   1              if(dev_def.dev_mode == DEV_REMOTE)
  43   1              {
  44   2                      
  45   2              }
  46   1              else if(dev_def.dev_mode == DEV_TIME)
  47   1              {
  48   2                      incJoggingTime();       
  49   2              }
  50   1              else
  51   1              {
  52   2                      CON_RELAY = !RELAY1;
  53   2                      KEY = 1;
C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 00:44:39 PAGE 2   

  54   2                      dev_def.update_flag = true;
  55   2              }
  56   1      }
  57          static void key2_short_press(void)
  58          {
  59   1              //RF_LED = !RF_LED;
  60   1      }
  61          static void key2_short_up_press(void)
  62          {
  63   1              if(dev_def.dev_mode == DEV_REMOTE)
  64   1              {
  65   2                      
  66   2              }
  67   1              else if(dev_def.dev_mode == DEV_TIME)
  68   1              {
  69   2                      decJoggingTime();
  70   2              }
  71   1      }
  72          static void key1_long_press(void)
  73          {
  74   1              if(dev_def.dev_mode == DEV_REMOTE)
  75   1              {
  76   2                      
  77   2              }
  78   1              else if(dev_def.dev_mode == DEV_TIME)
  79   1              {
  80   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  81   2                      RfLedOff();
  82   2              }
  83   1              else
  84   1              {
  85   2                      KEY = 1;
  86   2              }
  87   1      }
  88          static void key2_long_press(void)
  89          {
  90   1              if(dev_def.dev_mode == DEV_TIME)
  91   1              {
  92   2                      dev_def.dev_mode = dev_def.last_dev_mode;
  93   2                      RfLedOff();
  94   2              }
  95   1      }
  96          
  97          static void key1_long_up_press(void)
  98          {
  99   1              
 100   1      }
 101          static void key2_long_up_press(void)
 102          {
 103   1              
 104   1      }
 105          static void key1_twice_press(void)
 106          {
 107   1              if(dev_def.dev_mode == DEV_JOGGING)
 108   1              {
 109   2                      dev_def.dev_mode = DEV_SELFLOCK;
 110   2                      dev_def.last_dev_mode = DEV_SELFLOCK;
 111   2                      CON_RELAY = 0;
 112   2                      dev_def.update_flag = true;
 113   2              }
 114   1              else if(dev_def.dev_mode == DEV_SELFLOCK)
 115   1              {
C51 COMPILER V9.52.0.0   KEY                                                               08/31/2017 00:44:39 PAGE 3   

 116   2                      dev_def.dev_mode = DEV_JOGGING;
 117   2                      dev_def.last_dev_mode = DEV_JOGGING;
 118   2                      CON_RELAY = 0;
 119   2                      dev_def.update_flag = true;
 120   2              }
 121   1              else
 122   1              {
 123   2                      /*do nothing*/
 124   2              }
 125   1      }
 126          static void key2_twice_press(void)
 127          {
 128   1              if(dev_def.dev_mode != DEV_REMOTE)
 129   1              {
 130   2                      dev_def.dev_mode = DEV_TIME;
 131   2                      RfLedOnXt(10,10,1);
 132   2              }
 133   1      }
 134          
 135          static void registerKeys(void)
 136          {
 137   1          keyRegisterSingle(key1_is_press,key1_short_press,key1_short_up_press,key1_long_press,key1_long_up_pres
             -s,key1_twice_press);
 138   1          keyRegisterSingle(key2_is_press,key2_short_press,key2_short_up_press,key2_long_press,key2_long_up_pres
             -s,key2_twice_press);
 139   1      }
 140          void keyInit(void)
 141          {
 142   1              P1M1 |= 0xA0;//初始化为输入
 143   1              P1M2 &= 0X5f;
 144   1              P0M1 &= 0xE7;
 145   1              P0M2 |= 0X18; 
 146   1              CON_RELAY = 0;
 147   1              registerKeys();
 148   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    322    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
